providers = ["node"]

[phases.setup]
# Prisma requires OpenSSL at runtime for query engine.
nixPkgs = ["openssl"]

[phases.install]
cmds = [
  "npm --prefix backend install",
  "npm --prefix frontend install"
]

[phases.build]
cmds = [
  # Build the React app
  "npm --prefix frontend run build",
  # Generate Prisma client then build the backend
  "npm --prefix backend run prisma:generate",
  "npm --prefix backend run build"
]

[start]
cmd = "node backend/dist/server.js"

# Env expected at runtime (set these in your platform):
# DATABASE_URL, JWT_SECRET, PORT=4000, SOCKET_ORIGIN

